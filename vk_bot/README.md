# VkScheduleBot
Бот для ВК показывающий расписание занятий. Вы можете протестировать его работу, перейдя по ссылке: [VkScheduleBot](https://vk.com/club199143657)

![Docker Cloud Build Status](https://img.shields.io/docker/cloud/build/paladin705/vk_schedule_bot)

## Зависимости
Бот использует VK Callback API. Он должен обрабатывать следующие типы событий: Входящие сообщения и Запрет на получение. Адрес: `http://<адрес сервера>/bmstu_bot/`.

Бот реализованный в docker контейнере не имеет прямого доступа к сети и использует сокет `/bot/socket/bot.sock` для обработки запросов. Чтобы передать поступающие запросы боту, можно использовать nginx reverse proxy для передачи их на сокет бота.

## Docker
Для запуска docker контейнера можно использовать следующую команду:
```shell
docker run \
    -v ./vk_bot/socket:/bot/socket \
    -v ./vk_bot/log:/bot/log \
    -e DB_NAME=<Введите значение параметра> \
    -e DB_USER=Введите значение параметра<> \
    -e DB_PASSWORD=<Введите значение параметра> \
    -e DB_HOST=<Введите значение параметра> \
    -e VK_CONFIRMATION_TOKEN=<Введите значение параметра> \
    -e VK_API_TOKEN=<Введите значение параметра> \
    -e STATISTIC_TOKEN=<Введите значение параметра> \
    -e WEEK_TYPE=<Введите значение параметра> \
    -e ADMIN_VK_ID=<Введите значение параметра> \
    -e TZ=<Введите значение параметра> \
    paladin705/vk_schedule_bot:latest
```

### Файлы
* `/bot/socket` - В данной директории находится сокет бота: `bot.sock`. Он используется для обработки запросов к боту
* `/bot/log` - Директория где располагаются логи бота

### Переменные среды

* `DB_NAME` - Название базы данных (БД)
* `DB_USER` - Имя пользователя БД
* `DB_PASSWORD` - Пароль пользователя БД
* `DB_HOST` - Адрес БД
* `VK_CONFIRMATION_TOKEN` - Токен для подтверждения адреса сервера. Параметр VK Callback API 
* `VK_API_TOKEN` - Ключ доступа к сообщениям сообщества. Параметр VK API
* `STATISTIC_TOKEN` - Токен для отправки статистики на [chatbase.com](https://chatbase.com/). Необязательный параметр
* `WEEK_TYPE` - Тип первой недели семестра 0 - числитель, 1 - знаменатель
* `ADMIN_VK_ID` - VK ID страницы администратора (только номер) для отправки информации о состоянии сервера. Необязательный параметр
* `TZ` - Часовой пояс. По умолчанию `Europe/Moscow`

